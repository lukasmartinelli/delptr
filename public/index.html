<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Don't leak Memory! Use Smart Pointers in C++</title>
        <link href="screen.css" rel="stylesheet" type="text/css">
        <link href='http://fonts.googleapis.com/css?family=Anton' rel='stylesheet' type='text/css'>
        <link href='http://fonts.googleapis.com/css?family=Droid+Sans+Mono' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/8.4.0/styles/monokai_sublime.min.css">
    </head>
    <body>
        <header>
            <h1>Don't leak Memory!<br />
                Use <a href="http://en.cppreference.com/w/cpp/memory/unique_ptr">smart pointers!</a>
            </h1>
        </header>
        <section class="main">
            <div class="blame">
                <div class="avatar">
                    <img data-bind="attr: { src: avatarUrl }" />
                    <h2>
                        <a data-bind="attr: { href: userUrl }">
                            <span data-bind="text: username"></span>
                        <a/>
                        <span>managed his own memory in commit</span>
                        <a data-bind="attr: { href: commitUrl }">
                            <span data-bind="text: commitSha"></span>
                        </a>
                        <span></span>
                    </h2>
                    <h3>
                        <span data-bind="text: filename() + ':' + linenumber()"></span>
                    </h3>
                </div>
                <div class="code">
                    <pre>
                        <code id="code-fragment" data-bind="text: code">
                        </code>
                    </pre>
                </div>
            </div>
            <div class="status">
              <p data-bind="text: status"></p>
            </div>
        </section>
        <script src="//cdn.jsdelivr.net/socket.io-client/1.2.0/socket.io.min.js"></script>
        <script src="//cdn.jsdelivr.net/jquery/2.1.1/jquery.min.js"></script>
        <script src="//cdn.jsdelivr.net/highlight.js/8.4.0/highlight.min.js"></script>
        <script src="//cdn.jsdelivr.net/knockout/3.2.0/knockout.js"></script>
        <script>
            (function(){
                hljs.initHighlightingOnLoad();

                var model = {
                    status: ko.observable(),
                    username: ko.observable(),
                    userUrl: ko.observable(),
                    avatarUrl: ko.observable(),
                    commitSha: ko.observable(),
                    commitUrl: ko.observable(),
                    code: ko.observable(),
                    filename: ko.observable(),
                    linenumber: ko.observable(),
                };

                ko.applyBindings(model);

                // Somehow only works with static url hack
                if (typeof location.origin === 'undefined') {
                      location.origin = location.protocol + '//' + location.host;
                }
                var url = location.origin;
                var socket = io(url).connect();

                socket.on('linterror', function(msg) {
                    model.username(msg.actor.login);
                    model.userUrl('https://github.com/' + msg.actor.login);
                    model.commitUrl('https://github.com/' + msg.repo.name +
                                    '/commit/' + msg.commit.sha);
                    model.avatarUrl(msg.actor.avatar_url);
                    model.filename(msg.filename);
                    model.linenumber(msg.error.linenumber);
                    model.commitSha(msg.commit.sha.slice(0,10));

                    model.code(msg.code);
                    hljs.highlightBlock(document.getElementById('code-fragment'));
                });

                socket.on('lintsuccess', function(msg) {
                  model.status(msg.actor.login + ' pushed commit ' + msg.commit.sha.slice(0,10) + ' to ' + msg.repo.name + ' and passed the check.');
                });

              $(window).on('beforeunload', function(){
                  socket.close();
              });

            })();
        </script>
    </body>
</html>

